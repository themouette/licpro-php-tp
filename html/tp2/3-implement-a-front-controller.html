<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <title></title>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; }
code > span.dt { color: #204a87; }
code > span.dv { color: #0000cf; }
code > span.bn { color: #0000cf; }
code > span.fl { color: #0000cf; }
code > span.ch { color: #4e9a06; }
code > span.st { color: #4e9a06; }
code > span.co { color: #8f5902; font-style: italic; }
code > span.ot { color: #8f5902; }
code > span.al { color: #ef2929; }
code > span.fu { color: #000000; }
code > span.er { font-weight: bold; }
  </style>
<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/css/bootstrap-combined.min.css" rel="stylesheet">
<script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/js/bootstrap.min.js"></script>
</head>
<body>
<div class="container">
<h1 id="front-controller">Front controller</h1>
<h2 id="extra-configuration">Extra Configuration</h2>
<p>The virtual machine configuration has been updated with a virtualhost on port <code>81</code>. Update the configuration by running the following commands on the host machine:</p>
<pre><code>$ git pull origin master
$ git submodule update --init
$ vagrant reload</code></pre>
<p>You can access the new virtual host at <code>http://33.33.33.10:81</code> or <code>http://locahost:8090</code>. It points to the <code>/var/www/uframework/web/</code> folder on the virtual machine.</p>
<p>In this folder, extract this <a href="uframework.tgz">archive</a>. As seen in practical #1, you can extract this archive on the host machine at <code>DOCROOT/projects/uframework</code>:</p>
<pre><code>$ mkdir $DOCROOT/projects/uframework
$ wget uframework.tgz -O $DOCROOT/projects/uframework/uframework.tgz
$ cd $DOCROOT/projects/uframework
$ tar xvzf uframework.tgz
$ rm uframework.tgz</code></pre>
<h2 id="phpunit">PHPUnit</h2>
<p><a href="http://phpunit.de"><code>phpunit</code></a> is a PHP testing framework part of the <em>xUnit</em> family. To install it globally in the virtual machine, run:</p>
<pre class="sourceCode bash"><code class="sourceCode bash">vagrant@vm-licpro $ <span class="kw">wget</span> http://pear.phpunit.de/get/phpunit.phar
vagrant@vm-licpro $ <span class="kw">chmod</span> a+x
vagrant@vm-licpro $ <span class="kw">sudo</span> <span class="kw">mv</span> phpunit.phar /usr/bin/phpunit</code></pre>
<p>Did it work? Try to print the PHPUnit version:</p>
<pre><code>vagrant@vm-licpro $ phpunit --version</code></pre>
<p>Run a test suite with the following command:</p>
<pre><code>vagrant@vm-licpro $ phpunit</code></pre>
<p>The <code>phar</code> execution might require to add <code>/etc/php5/cli/conf.d/suhosin-allow-phar.ini</code> with the following content:</p>
<pre class="sourceCode ini"><code class="sourceCode ini"><span class="dt">suhosin.executor.include.whitelist</span><span class="ot">=</span><span class="st">&quot;phar&quot;</span></code></pre>
<h2 id="anatomy-of-uframework">Anatomy of uFramework</h2>
<p>The directory layout looks like this:</p>
<pre><code>├ app/      # the application directory
├ src/      # the framework sources
├ tests/    # the test suite
├ web/      # public directory
└ autoload.php</code></pre>
<h3 id="app-directory"><code>app</code> directory</h3>
<p>Your application controllers will be registered as closures in <code>app.php</code>. Templates will be put in the <code>templates/</code> directory.</p>
<h3 id="src-directory"><code>src</code> directory</h3>
<p>The framework sources. You will have to complete the missing parts.</p>
<h3 id="tests-directory"><code>tests</code> directory</h3>
<p>The test suite, all tests have to pass at the end :)</p>
<p>Run it with the following command:</p>
<pre><code>vagrant@vm-licpro $ phpunit</code></pre>
<h3 id="web-directory"><code>web</code> directory</h3>
<p>Contains the public part.</p>
<p>The <code>index.php</code> file is the only entry point for this application. It is called a <code>front controller</code>.</p>
<h2 id="goal">Goal</h2>
<p>Today's goal is to create a simple PHP application to <strong>C</strong>reate, <strong>R</strong>etrieve, <strong>U</strong>pdate, and <strong>D</strong>elete locations.</p>
<p>This is called a <strong>CRUD</strong> application.</p>
<p>This application will respect <strong>REST</strong> conventions, that means the use of HTTP verbs, and consistent URIs.</p>
<p>All routes will be declared in <code>app/app.php</code> as follow:</p>
<pre class="sourceCode php"><code class="sourceCode php">$app-&gt;post(&#39;/locations&#39;, $callable);
$app-&gt;get(&#39;/locations/(\d+)&#39;, $callable);
$app-&gt;put(&#39;/locations/(\d+)&#39;, $callable);
$app-&gt;delete(&#39;/locations/(\d+)&#39;, $callable);</code></pre>
<p><code>$callable</code> can either be a closure, an array or a function name. More on this in the <a href="http://php.net/manual/en/language.types.callable.php">PHP manual</a>.</p>
<h2 id="create-routes-and-templates">Create Routes and Templates</h2>
<h2 id="create-a-model-class">Create a Model class</h2>
<p>Create a Location class in <code>src/Model</code>. This class <strong>must</strong> implement <code>Model\FinderInterface</code>.</p>
<h2 id="complete-get-routes">Complete GET Routes</h2>
<p>Complete the <code>GET</code> routes predefined in <code>app/app.php</code> file and create the corresponding templates.</p>
<p>You should be able to:</p>
<ul>
<li>list locations under <code>GET /locations</code>;</li>
<li>display a location with <code>id</code> under <code>GET /locations/id</code>;</li>
</ul>
<p>When loading <code>http://33.33.33.10:81/</code> an error should appear. Let's fix this by implementing uFramework missing parts.</p>
<h2 id="complete-uframework-kernel">Complete uFramework kernel</h2>
<p>The kernel is defined in <code>src/App.php</code> and has been altered. Complete the <code>registerRoute()</code> method.</p>
<p>Complete <code>put()</code>, <code>post()</code>, and <code>delete()</code> methods as well.</p>
<h2 id="add-a-basic-model-persistence">Add a basic Model Persistence</h2>
<p>Locations will be stored in <code>data/locations.json</code>.</p>
<p>To manipulate JSON, SPL defines both <code>json_encode()</code> and <code>json_decode()</code>. Use the <a href="http://php.net">PHP manual</a> to know how to use these methods in order to create a persistent model layer.</p>
<blockquote>
<p><em>Hint:</em> one method returns an array from a JSON string, the one is able to transform an array into a JSON string. You saw a few methods last week that can be used to read/write files.</p>
</blockquote>
<p>Add a form on the location list page. This form will POST data to <code>/locations</code> in order to create a new location.</p>
<p>Add a form on the location details page to enable edition. This form will PUT changes at <code>/locations/id</code> in order to update the resource.</p>
<p>On the location detail page, another form will DELETE the resource located at <code>/locations/id</code>.</p>
</div>
</body>
</html>
